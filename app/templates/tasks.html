<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>定时任务管理 - WorkClock</title>
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/tasks.css') }}">
</head>
<body>
    <div class="container">
        <h1>定时任务管理</h1>
        
        <div class="task-tabs">
            <div class="task-tab active" onclick="showTab('settings')">任务设置</div>
            <div class="task-tab" onclick="showTab('logs')">执行记录</div>
        </div>
        
        <div id="settings" class="task-content active">
            <div class="tasks-summary">
                <p>当前活跃任务：<span class="active-count">{{ active_tasks_count }}</span>/{{ max_users }}</p>
                <p class="task-note">注：只有同时启用了任务状态且设置了至少一个打卡时间的用户才计入活跃任务数</p>
            </div>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>用户姓名</th>
                            <th>用户ID</th>
                            <th>部门ID</th>
                            <th>上班定时</th>
                            <th>下班定时</th>
                            <th>启用状态</th>
                            <th>更新时间</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for task in tasks %}
                        <tr>
                            <td>{{ task.id }}</td>
                            <td>{{ task.user_name }}</td>
                            <td>{{ task.user_id }}</td>
                            <td>{{ task.dep_id }}</td>
                            <td class="bool-{{ task.morning }}">{{ "是" if task.morning else "否" }}</td>
                            <td class="bool-{{ task.afternoon }}">{{ "是" if task.afternoon else "否" }}</td>
                            <td class="status-{{ task.enabled }}">{{ "启用" if task.enabled else "禁用" }}</td>
                            <td>{{ task.updated_at }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        
        <div id="logs" class="task-content">
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>用户姓名</th>
                            <th>任务类型</th>
                            <th>执行时间</th>
                            <th>状态</th>
                            <th>消息</th>
                            <th>创建时间</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for log in logs %}
                        <tr>
                            <td>{{ log.id }}</td>
                            <td>{{ log.user_name }}</td>
                            <td>{{ "上班" if log.task_type == "morning" else "下班" }}</td>
                            <td>{{ log.task_time }}</td>
                            <td class="task-status-{{ log.status }}">{{ log.status }}</td>
                            <td>{{ log.message }}</td>
                            <td>{{ log.created_at }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        
        <a href="{{ url_for('main.dashboard') }}" class="back-link">返回仪表盘</a>
    </div>
    
    <script src="{{ url_for('static', filename='js/tasks.js') }}"></script>
</body>
</html> 