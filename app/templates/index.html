<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>打卡系统</title>
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/index.css') }}">
</head>
<body>
    <div class="container">
        <div id="loading-spinner" class="loading-overlay">
            <div class="spinner"></div>
            <div class="loading-text">加载中...</div>
        </div>
        <div class="header">
            <h2>用户信息</h2>
            <div class="header-buttons">
                <button onclick="logout()" class="logout-button">退出登录</button>
            </div>
        </div>
        <div class="user-info">
            <div class="user-header">
                <span id="userName"></span>
                <span class="divider">|</span>
                <span id="position"></span>
            </div>
            <div class="department-info">
                <span id="depName"></span>
                <span class="id-info">(<span id="depId"></span>/<span id="userId"></span>)</span>
            </div>
        </div>

        <div class="attendance-list">
            <div class="stats-header">
                <h3>考勤记录</h3>
                <div class="header-buttons">
                    <button onclick="showAttendanceStats()" class="nav-button">考勤统计</button>
                    <button onclick="showScheduleModal()" class="nav-button">添加定时</button>
                </div>
            </div>
            <div id="attendanceData"></div>
        </div>

        <div class="attendance-stats" style="display: none;">
            <div class="stats-header">
                <h3>考勤统计</h3>
                <div class="header-buttons">
                    <select id="monthSelect" class="month-select" onchange="showAttendanceStats()">
                        {% for month in range(1, 13) %}
                            <option value="{{ month }}">{{ month }}月</option>
                        {% endfor %}
                    </select>
                    <button onclick="showAttendanceList()" class="nav-button">今日打卡</button>
                </div>
            </div>
            <div class="stats-summary">
                <div class="summary-title">本月统计<span class="summary-note">（当天考勤结束前不计入统计）</span></div>
                <div class="summary-items">
                    <div class="summary-item">
                        <span class="item-label">请假：</span>
                        <span class="item-value" id="leaveDays">0</span>天
                    </div>
                    <div class="summary-item">
                        <span class="item-label">迟到：</span>
                        <span class="item-value" id="lateNumber">0</span>次
                    </div>
                    <div class="summary-item">
                        <span class="item-label">早退：</span>
                        <span class="item-value" id="ztNumber">0</span>次
                    </div>
                    <div class="summary-item">
                        <span class="item-label">缺卡：</span>
                        <span class="item-value" id="lackCarNumber">0</span>次
                    </div>
                </div>
            </div>
            <div class="stats-table">
                <table>
                    <thead>
                        <tr>
                            <th>日</th>
                            <th>一</th>
                            <th>二</th>
                            <th>三</th>
                            <th>四</th>
                            <th>五</th>
                            <th>六</th>
                        </tr>
                    </thead>
                    <tbody id="statsTableBody">
                    </tbody>
                </table>
            </div>
        </div>

        <button onclick="signIn()" class="sign-button" style="display: none;">
            <span>打卡</span>
            <span class="time" id="currentTime">19:21:00</span>
        </button>
        
        <!-- 定时打卡模态框 -->
        <div id="scheduleModal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>设置定时打卡</h3>
                    <span class="close" onclick="closeScheduleModal()">&times;</span>
                </div>
                <div class="modal-body">
                    <p>请选择您需要的定时打卡时间：</p>
                    <div class="schedule-options">
                        <div class="schedule-option">
                            <input type="checkbox" id="scheduleMorning" name="scheduleMorning">
                            <label for="scheduleMorning">早上自动打卡</label>
                        </div>
                        <div class="schedule-option">
                            <input type="checkbox" id="scheduleAfternoon" name="scheduleAfternoon">
                            <label for="scheduleAfternoon">下午自动打卡</label>
                        </div>
                    </div>
                    <div class="schedule-note">
                        <p>注意：系统将在指定时间自动为您打卡</p>
                    </div>
                    <div id="schedule-times" class="schedule-times" style="display: none;">
                        <div class="time-details">
                            <p class="time-title">您的打卡时间安排：</p>
                            <div id="morning-times" class="time-slots">
                                <span class="time-label">上午：</span>
                                <span class="time-values"></span>
                            </div>
                            <div id="afternoon-times" class="time-slots">
                                <span class="time-label">下午：</span>
                                <span class="time-values"></span>
                            </div>
                        </div>
                        <div id="user-limit-warning" class="limit-warning" style="display: none;">
                            <p>目前定时任务名额已满 (3/3)，暂无法添加。</p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button onclick="saveSchedule()" class="save-button">保存</button>
                    <button onclick="closeScheduleModal()" class="cancel-button">取消</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 引入外部JavaScript文件 -->
    <script src="{{ url_for('static', filename='js/index.js') }}"></script>
</body>
</html> 