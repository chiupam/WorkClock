{% extends "admin/index.html" %}

{% block title %}{{ page_title }}{% endblock %}

{% block styles %}
<link rel="icon" type="image/x-icon" href="/static/favicon.ico">
<link rel="stylesheet" href="/static/css/admin/dashboard.css">
{% endblock %}

{% block content %}
<div class="dashboard-container">
    <div class="dashboard-header">
        <h1>ç®¡ç†å‘˜ä»ªè¡¨ç›˜</h1>
        <p class="welcome-text">æ¬¢è¿å›æ¥ï¼Œ{{ user_info.username }}</p>
        <p class="current-time">å½“å‰æ—¶é—´: {{ current_time }}</p>
    </div>

    <div class="stats-overview">
        <div class="stats-card">
            <div class="stats-icon">ğŸ‘¥</div>
            <div class="stats-content">
                <div class="stats-value">{{ stats.total_users }}</div>
                <div class="stats-label">æ€»ç”¨æˆ·æ•°</div>
            </div>
        </div>
        <div class="stats-card">
            <div class="stats-icon">ğŸ”†</div>
            <div class="stats-content">
                <div class="stats-value">{{ stats.active_users_today }}</div>
                <div class="stats-label">ä»Šæ—¥æ´»è·ƒç”¨æˆ·</div>
            </div>
        </div>
        <div class="stats-card">
            <div class="stats-icon">ğŸ“†</div>
            <div class="stats-content">
                <div class="stats-value">{{ stats.active_users_week }}</div>
                <div class="stats-label">æœ¬å‘¨æ´»è·ƒç”¨æˆ·</div>
            </div>
        </div>
        <div class="stats-card">
            <div class="stats-icon">ğŸ“Š</div>
            <div class="stats-content">
                <div class="stats-value">{{ stats.active_users_month }}</div>
                <div class="stats-label">æœ¬æœˆæ´»è·ƒç”¨æˆ·</div>
            </div>
        </div>
    </div>

    <div class="system-info">
        <h2>ç³»ç»Ÿä¿¡æ¯</h2>
        <div class="info-grid">
            <div class="info-item">
                <div class="info-label">ç³»ç»Ÿåç§°</div>
                <div class="info-value">{{ stats.system_name }}</div>
            </div>
            <div class="info-item">
                <div class="info-label">ç³»ç»Ÿç‰ˆæœ¬</div>
                <div class="info-value">{{ stats.system_version }}</div>
            </div>
            <div class="info-item">
                <div class="info-label">ç³»ç»Ÿå¯åŠ¨æ—¶é—´</div>
                <div class="info-value">{{ stats.system_start_time }}</div>
            </div>
            <div class="info-item">
                <div class="info-label">ä»Šæ—¥ç™»å½•æ¬¡æ•°</div>
                <div class="info-value">{{ stats.today_logins }}</div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // æ˜¾ç¤ºå½“å‰æ—¶é—´å¹¶è‡ªåŠ¨æ›´æ–°
    function updateClock() {
        const now = new Date();
        const timeDisplay = document.querySelector('.current-time');
        if (timeDisplay) {
            const formattedTime = now.getFullYear() + '-' + 
                                 padZero(now.getMonth() + 1) + '-' + 
                                 padZero(now.getDate()) + ' ' + 
                                 padZero(now.getHours()) + ':' + 
                                 padZero(now.getMinutes()) + ':' + 
                                 padZero(now.getSeconds());
            timeDisplay.textContent = 'å½“å‰æ—¶é—´: ' + formattedTime;
        }
    }
    
    function padZero(num) {
        return num < 10 ? '0' + num : num;
    }
    
    // åˆå§‹æ›´æ–°å¹¶è®¾ç½®å®šæ—¶å™¨
    updateClock();
    setInterval(updateClock, 1000);
    
    // ç»Ÿè®¡å¡ç‰‡åŠ¨ç”»æ•ˆæœ
    const statsCards = document.querySelectorAll('.stats-card');
    statsCards.forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-5px)';
            this.style.boxShadow = '0 5px 15px rgba(0, 0, 0, 0.15)';
        });
        
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
            this.style.boxShadow = '0 2px 10px rgba(0, 0, 0, 0.1)';
        });
    });
    
    // ä½¿ç”¨axiosè·å–æœ€æ–°ç»Ÿè®¡æ•°æ®
    function refreshStats() {
        axios.get('/admin/stats-data')
            .then(function(response) {
                if (response.data.success) {
                    const stats = response.data.stats;
                    // æ›´æ–°ç»Ÿè®¡æ•°æ®
                    document.querySelector('.stats-card:nth-child(1) .stats-value').textContent = stats.total_users;
                    document.querySelector('.stats-card:nth-child(2) .stats-value').textContent = stats.active_users_today;
                    document.querySelector('.stats-card:nth-child(3) .stats-value').textContent = stats.active_users_week;
                    document.querySelector('.stats-card:nth-child(4) .stats-value').textContent = stats.active_users_month;
                }
            })
            .catch(function(error) {
                console.error('è·å–ç»Ÿè®¡æ•°æ®å¤±è´¥:', error);
            });
    }
    
    // æ¯60ç§’åˆ·æ–°ä¸€æ¬¡ç»Ÿè®¡æ•°æ®
    setInterval(refreshStats, 60000);
});
</script>
{% endblock %}
